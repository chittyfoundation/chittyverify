# ChittyChain Evidence Ledger - Production Deployment Guide

## 🚀 **INDEPENDENT ROOT SERVER DEPLOYMENT**

This comprehensive guide covers deploying the ChittyChain Evidence Ledger to independent root servers across major cloud providers. The system is designed to be completely self-contained and not reliant on local connections.

---

## 📋 **System Requirements**

### Minimum Requirements
- **CPU**: 2 cores, Recommended 4+ cores
- **RAM**: 4GB, Recommended 8GB+
- **Storage**: 50GB SSD, Recommended 100GB+ SSD
- **Network**: Public IP with ports 80, 443, 3000, 3001, 8080 accessible
- **OS**: Ubuntu 20.04+, CentOS 8+, or container platform

### Required Services
- **PostgreSQL 15+** (Neon Database recommended)
- **Redis 7+** (for caching and session management)
- **Docker & Docker Compose** (for containerized deployment)

---

## 🌐 **Cloud Provider Quick Deploy**

### 1. **Amazon Web Services (AWS)**

```bash
# Set environment variables
export AWS_ACCOUNT_ID="123456789012"
export AWS_REGION="us-east-1"
export DATABASE_URL="postgresql://user:pass@your-neon-db.neon.tech:5432/chittychain"
export REDIS_URL="redis://your-elasticache-endpoint:6379"

# Deploy to ECS (Recommended)
export DEPLOYMENT_TYPE="ecs"
export ECS_CLUSTER_NAME="chittychain-cluster"
export ECS_SUBNET_IDS="subnet-12345,subnet-67890"
export ECS_SECURITY_GROUP_ID="sg-abcdef123"

./deploy/aws/deploy.sh
```

**AWS Services Used:**
- ✅ **ECR**: Container image registry
- ✅ **ECS/Fargate**: Container orchestration
- ✅ **Application Load Balancer**: Traffic distribution
- ✅ **CloudWatch**: Logging and monitoring

### 2. **Google Cloud Platform (GCP)**

```bash
# Set environment variables
export GOOGLE_CLOUD_PROJECT="your-project-id"
export GCP_REGION="us-central1"
export DATABASE_URL="postgresql://user:pass@your-neon-db.neon.tech:5432/chittychain"

# Deploy to Cloud Run (Recommended)
export DEPLOYMENT_TYPE="cloudrun"
./deploy/gcp/deploy.sh
```

**GCP Services Used:**
- ✅ **Container Registry**: Container image storage
- ✅ **Cloud Run**: Serverless container platform
- ✅ **Cloud Load Balancing**: Traffic distribution

### 3. **Microsoft Azure**

```bash
# Set environment variables
export AZURE_RESOURCE_GROUP="chittychain-rg"
export AZURE_LOCATION="eastus"
export DATABASE_URL="postgresql://user:pass@your-neon-db.neon.tech:5432/chittychain"

# Deploy to Container Instances (Recommended)
export DEPLOYMENT_TYPE="aci"
./deploy/azure/deploy.sh
```

**Azure Services Used:**
- ✅ **Container Registry**: Container image repository
- ✅ **Container Instances**: Serverless containers
- ✅ **Application Gateway**: Load balancing

---

## 🐳 **Docker Quick Start**

### Option 1: Docker Compose (Simplest)

```bash
# Clone repository
git clone https://github.com/your-org/ChittyChain.git
cd ChittyChain

# Copy environment configuration
cp .env.example .env
# Edit .env with your configuration

# Start all services
docker-compose up -d

# Check health
curl http://localhost:8080/health
```

### Option 2: Standalone Container

```bash
# Pull latest image
docker pull ghcr.io/your-org/chittychain-evidence-ledger:latest

# Run container
docker run -d \
  --name chittychain-evidence-ledger \
  -p 3000:3000 \
  -p 3001:3001 \
  -p 8080:8080 \
  -e DATABASE_URL="your-database-url" \
  -e REDIS_URL="your-redis-url" \
  -e NODE_ENV=production \
  --restart unless-stopped \
  ghcr.io/your-org/chittychain-evidence-ledger:latest
```

---

## ⚙️ **Environment Configuration**

### Required Environment Variables

```bash
# Database Configuration (Neon PostgreSQL)
DATABASE_URL="postgresql://user:password@host.neon.tech:5432/chittychain?sslmode=require"

# Redis Configuration (for caching)
REDIS_URL="redis://host:6379"

# Application Configuration
NODE_ENV=production
PORT=3000
MCP_PORT=3001
API_PORT=8080

# Security Configuration
JWT_SECRET="your-super-secret-jwt-key-here"
SESSION_SECRET="your-session-secret-here"
ENCRYPTION_KEY="your-32-character-encryption-key"

# Monitoring Configuration
ENABLE_METRICS=true
ENABLE_TRACING=true
LOG_LEVEL=info
```

---

## 🔧 **Manual Server Setup**

### Ubuntu 20.04+ Installation

```bash
# Update system
sudo apt update && sudo apt upgrade -y

# Install Docker
curl -fsSL https://get.docker.com -o get-docker.sh
sudo sh get-docker.sh
sudo usermod -aG docker $USER

# Install Docker Compose
sudo curl -L "https://github.com/docker/compose/releases/latest/download/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
sudo chmod +x /usr/local/bin/docker-compose

# Create application directories
sudo mkdir -p /opt/chittychain/{data,logs,config}
sudo chown -R $USER:$USER /opt/chittychain

# Clone and setup application
cd /opt/chittychain
git clone https://github.com/your-org/ChittyChain.git .
npm install --production

# Setup environment
cp .env.example .env
nano .env  # Edit with your configuration

# Deploy database schema
npm run db:deploy

# Start application
npm start
```

---

## 🔒 **Security Configuration**

### Firewall Setup

```bash
# Ubuntu/Debian (ufw)
sudo ufw allow 22/tcp    # SSH
sudo ufw allow 80/tcp    # HTTP
sudo ufw allow 443/tcp   # HTTPS
sudo ufw allow 3000/tcp  # Main API
sudo ufw allow 3001/tcp  # MCP Server
sudo ufw allow 8080/tcp  # Health/Metrics
sudo ufw enable
```

### SSL/TLS Certificate Setup

```bash
# Install Certbot
sudo apt install certbot python3-certbot-nginx -y

# Obtain certificate
sudo certbot --nginx -d your-domain.com

# Auto-renewal
sudo crontab -e
# Add: 0 12 * * * /usr/bin/certbot renew --quiet
```

---

## 📊 **Monitoring & Health Checks**

### Health Check Endpoints

```bash
# System health
curl https://your-domain.com/health

# Detailed metrics
curl https://your-domain.com/metrics

# MCP server status
curl https://your-domain.com:3001/status
```

### Key Monitoring Endpoints

- **Main API**: `http://your-domain:3000`
- **MCP Server**: `http://your-domain:3001`
- **Health Check**: `http://your-domain:8080/health`
- **Metrics**: `http://your-domain:8080/metrics`

---

## 🔄 **CI/CD Pipeline**

The repository includes a comprehensive CI/CD pipeline (`.github/workflows/deploy.yml`) that:

1. **Tests**: Runs comprehensive test suite with database integration
2. **Builds**: Creates Docker images for multiple architectures
3. **Security**: Scans for vulnerabilities using Trivy
4. **Deploys**: Automatically deploys to staging and production environments
5. **Notifies**: Sends deployment status to Slack channels

### Manual Deployment Triggers

```bash
# Deploy to staging
git push origin develop

# Deploy to production
git push origin main

# Release deployment
git tag v1.0.0
git push origin v1.0.0
```

---

## 🆘 **Troubleshooting**

### Common Issues

#### Database Connection Errors
```bash
# Test database connection
psql "$DATABASE_URL" -c "SELECT version();"

# Re-deploy schema
npm run db:deploy
```

#### Container Issues
```bash
# Check container status
docker ps -a

# View container logs
docker logs chittychain-evidence-ledger

# Restart container
docker restart chittychain-evidence-ledger
```

#### Port Conflicts
```bash
# Check port usage
sudo netstat -tulpn | grep :3000

# Kill process using port
sudo kill -9 $(sudo lsof -t -i:3000)
```

---

## 📞 **Support & Maintenance**

### Regular Maintenance

```bash
# Weekly maintenance script
#!/bin/bash

# Update Docker images
docker-compose pull
docker-compose up -d

# Clean up old images
docker image prune -f

# Backup database
pg_dump "$DATABASE_URL" > backup_$(date +%Y%m%d).sql

# Restart services
docker-compose restart
```

### Backup & Recovery

```bash
# Database backup
pg_dump "$DATABASE_URL" | gzip > chittychain_backup_$(date +%Y%m%d_%H%M%S).sql.gz

# Recovery
gunzip < backup.sql.gz | psql "$DATABASE_URL"
```

---

## 🎯 **Production Checklist**

After successful deployment:

- [ ] Configure domain and SSL certificates
- [ ] Set up monitoring dashboards
- [ ] Configure backup automation
- [ ] Implement log aggregation
- [ ] Set up alerting rules
- [ ] Performance tune based on usage patterns
- [ ] Test disaster recovery procedures

---

## 📚 **Legacy Deployment (Railway)**

### Current Railway Status
✅ **Deployed**: https://chittychainv2-production.up.railway.app  
✅ **Health Check**: `/health` endpoint available  
⚠️ **Configuration**: Requires Clerk.com setup for full functionality

### Railway-Specific Commands
```bash
npm run cli:status
npm run cli:verify
npm run cli:mint
```

The ChittyChain Evidence Ledger is now ready for production use with legal-grade evidence management, blockchain integration, and comprehensive audit trails.

---

**For additional support or questions, please contact the ChittyChain development team.**