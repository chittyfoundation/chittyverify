# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Overview

The ChittyOS Trust Engine is a revolutionary 6-dimensional trust scoring system that evaluates entities (people, organizations, AI agents) based on verifiable actions and outcomes rather than traditional credit metrics. It prioritizes justice and positive societal impact over institutional gatekeeping.

## Architecture

### Core Components
- **core.py**: Main TrustEngine class and calculate_trust() convenience function
- **dimensions.py**: Six trust dimension calculators (Source, Temporal, Channel, Outcome, Network, Justice)
- **models.py**: Pydantic models for TrustEntity, TrustEvent, Credential, Connection
- **scores.py**: Four output score calculators (People's, Legal, State, Chitty Score™)

### 6D Trust Dimensions
1. **Source (Who)**: Identity verification and credential assessment (0-100)
2. **Temporal (When)**: Time-based analysis and behavioral consistency (0-100)
3. **Channel (How)**: Communication and transaction channel trust levels (0-100)
4. **Outcome (Results)**: Track record of positive/negative outcomes (0-100)
5. **Network (Connections)**: Quality and trust level of network connections (0-100)
6. **Justice (Impact)**: Alignment with justice principles and societal benefit (0-100)

### Output Scores
- **People's Score**: Community impact (emphasizes network & justice)
- **Legal Score**: Technical compliance (emphasizes verification)
- **State Score**: Authority approval (emphasizes credentials)
- **Chitty Score™**: Justice + outcomes - the true measure of trustworthiness

## Development Commands

### Setup & Installation
```bash
# Install with Poetry (Python 3.11+)
poetry install

# Or with pip
pip install -e .
```

### Testing
```bash
# Run all tests
pytest

# Run with coverage
pytest --cov=chitty_trust --cov-report=html

# Run specific test
pytest tests/test_core.py::test_trust_engine_initialization

# Run tests in watch mode
pytest-watch
```

### Code Quality
```bash
# Format code
black src/ tests/

# Lint code
ruff check src/ tests/

# Type checking
mypy src/
```

### Example Usage
```bash
# Run the interactive demo
python example_usage.py

# This shows three personas:
# - Alice Community: High trust community leader
# - Bob Business: Mixed history with dispute resolution
# - Charlie Changed: Transformation story ("Shitty to Chitty")
```

## Key Features

### Event Tags System
Events can be tagged to influence scoring, especially for justice dimension:
- **Justice-positive**: `community_impact`, `justice`, `transparency`, `harm_prevention`, `helped_vulnerable`
- **Violations**: `violation`, `fraud`, `harassment`, `discrimination`
- **Special**: `transformation` (activates "Shitty to Chitty" bonus in Chitty Score)

### Channel Trust Hierarchy
```python
CHANNEL_TRUST_SCORES = {
    "verified_api": 95,
    "blockchain": 90,
    "bank_transfer": 85,
    "credit_card": 80,
    "oauth": 75,
    "email": 60,
    "sms": 55,
    "social_media": 40,
    "anonymous": 10,
}
```

### Scoring Algorithm
1. Calculate 6 dimension scores independently
2. Apply dimension weights to calculate output scores
3. Generate human-readable explanations
4. Calculate confidence based on data quantity, consistency, and recency

### Composite Score Weights
```python
weights = {
    "source": 0.15,
    "temporal": 0.10,
    "channel": 0.15,
    "outcome": 0.20,
    "network": 0.15,
    "justice": 0.25,
}
```

## Testing Patterns

### Basic Trust Calculation
```python
from chitty_trust import calculate_trust, TrustEntity, TrustEvent

entity = TrustEntity(
    id="user_123",
    entity_type="person",
    name="Jane Doe",
    created_at=datetime.utcnow(),
    identity_verified=True
)

events = [
    TrustEvent(
        id="evt_1",
        entity_id="user_123",
        event_type="transaction",
        timestamp=datetime.utcnow(),
        channel="blockchain",
        outcome="positive",
        impact_score=7.5,
        tags=["community_impact", "transparency"]
    )
]

trust_score = await calculate_trust(entity, events)
```

### Test Coverage Areas
- Basic trust calculation with valid data
- Empty events handling
- Negative events impact
- Transformation bonus testing
- Composite score calculation
- Dictionary conversion for API responses

## API Integration Pattern

```python
from fastapi import FastAPI
from chitty_trust import TrustEngine

app = FastAPI()
engine = TrustEngine()

@app.post("/trust/calculate")
async def calculate_trust_score(entity_id: str):
    entity = await load_entity(entity_id)
    events = await load_events(entity_id)
    score = await engine.calculate_trust(entity, events)
    return score.to_dict()
```

## Philosophy & Design Decisions

1. **Justice-First**: Unlike traditional credit scores that measure debt repayment ability, this system measures positive societal impact
2. **Transformation Recognition**: The "Shitty to Chitty" transformation bonus rewards genuine positive change
3. **Transparency**: All scoring logic is transparent and explainable
4. **Weighted Dimensions**: Different output scores weight dimensions differently based on stakeholder needs
5. **Confidence Levels**: Scores include confidence metrics based on data quality and recency

## Performance Considerations

- All dimension calculations are async for future optimization
- Scores are calculated on-demand, not stored
- Event processing uses numpy for efficient numerical operations
- Recent events are weighted more heavily in calculations